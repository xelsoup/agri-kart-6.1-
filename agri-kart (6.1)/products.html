<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products | Agri-Kart Seller</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        container: {
          center: true,
          padding: "2rem",
          screens: {
            "2xl": "1400px",
          },
        },
        extend: {
          colors: {
            border: "hsl(214.3 31.8% 91.4%)",
            input: "hsl(214.3 31.8% 91.4%)",
            ring: "hsl(142 76% 36%)",
            background: "hsl(0 0% 100%)",
            foreground: "hsl(222.2 84% 4.9%)",
            primary: {
              DEFAULT: "hsl(142 76% 36%)",
              foreground: "hsl(210 40% 98%)",
            },
            secondary: {
              DEFAULT: "hsl(210 40% 96.1%)",
              foreground: "hsl(222.2 47.4% 11.2%)",
            },
            destructive: {
              DEFAULT: "hsl(0 84.2% 60.2%)",
              foreground: "hsl(210 40% 98%)",
            },
            muted: {
              DEFAULT: "hsl(210 40% 96.1%)",
              foreground: "hsl(215.4 16.3% 46.9%)",
            },
            accent: {
              DEFAULT: "hsl(210 40% 96.1%)",
              foreground: "hsl(222.2 47.4% 11.2%)",
            },
            popover: {
              DEFAULT: "hsl(0 0% 100%)",
              foreground: "hsl(222.2 84% 4.9%)",
            },
            card: {
              DEFAULT: "hsl(0 0% 100%)",
              foreground: "hsl(222.2 84% 4.9%)",
            },
          },
          borderRadius: {
            lg: "0.5rem",
            md: "calc(0.5rem - 2px)",
            sm: "calc(0.5rem - 4px)",
          },
        },
      },
    }
  </script>
  <style type="text/tailwindcss">
    @layer base {
      * {
        @apply border-border;
      }
      body {
        @apply bg-background text-foreground;
      }
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body class="flex min-h-screen flex-col">
  <!-- Include header -->
  <div id="header-container"></div>

  <div class="flex flex-1">
    <!-- Sidebar -->
    <aside class="fixed inset-y-0 left-0 z-30 hidden w-64 border-r bg-background md:flex md:flex-col">
      <div class="flex h-16 items-center border-b px-6">
        <a href="dashboard.html" class="flex items-center gap-2 font-bold text-primary">
          <i class="ri-store-2-line h-6 w-6"></i>
          <span>Agri-Kart Seller</span>
        </a>
      </div>

      <nav class="flex-1 space-y-1 p-4">
        <a href="dashboard.html" class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted">
          <i class="ri-dashboard-line h-5 w-5"></i>
          Dashboard
        </a>
        <a href="products.html" class="flex items-center gap-3 rounded-lg bg-muted px-3 py-2 text-sm font-medium">
          <i class="ri-shopping-bag-line h-5 w-5"></i>
          Products
        </a>
        <a href="orders.html" class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted">
          <i class="ri-shopping-cart-line h-5 w-5"></i>
          Orders
        </a>
        <a href="analytics.html" class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted">
          <i class="ri-line-chart-line h-5 w-5"></i>
          Analytics
        </a>
      </nav>

      <div class="border-t p-4">
        <button id="logout-button" class="flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted">
          <i class="ri-logout-box-line h-5 w-5"></i>
          Logout
        </button>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 md:ml-64">
      <header class="border-b">
        <div class="flex h-16 items-center justify-between px-4 md:px-6">
          <h1 class="text-lg font-semibold md:text-2xl">Products</h1>
          <button id="add-product-button" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
            <i class="ri-add-line mr-2 h-4 w-4"></i>
            Add Product
          </button>
        </div>
      </header>

      <div class="p-6">
        <!-- Search and filters -->
        <div class="mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div class="flex w-full items-center gap-4 md:w-auto">
            <div class="relative w-full md:w-[300px]">
              <i class="ri-search-line absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"></i>
              <input type="search" placeholder="Search products..." class="flex h-10 w-full rounded-md border border-input bg-background pl-9 pr-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
            </div>
            <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
              <i class="ri-filter-line mr-2 h-4 w-4"></i>
              Filters
            </button>
          </div>
        </div>

        <!-- Products table -->
        <div class="rounded-lg border">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b bg-muted/50">
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Product</th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Category</th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Price</th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Stock</th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Status</th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Actions</th>
                </tr>
              </thead>
              <tbody id="products-table-body">
                <!-- Products will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add/Edit Product Modal -->
  <div id="product-modal" class="fixed inset-0 z-50 hidden">
    <div class="fixed inset-0 bg-background/80 backdrop-blur-sm"></div>
    <div class="fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 sm:rounded-lg md:w-full">
      <div class="flex flex-col space-y-1.5">
        <h2 id="modal-title" class="text-lg font-semibold leading-none tracking-tight">Add Product</h2>
        <p class="text-sm text-muted-foreground">Fill in the details of your product.</p>
      </div>
      <form id="product-form" class="space-y-4">
        <div class="space-y-2">
          <label for="product-name" class="text-sm font-medium leading-none">Name</label>
          <input id="product-name" type="text" required class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
        </div>
        <div class="grid gap-4 md:grid-cols-2">
          <div class="space-y-2">
            <label for="product-category" class="text-sm font-medium leading-none">Category</label>
            <select id="product-category" required class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
              <option value="">Select category</option>
              <option value="Vegetables">Vegetables</option>
              <option value="Fruits">Fruits</option>
              <option value="Grains">Grains</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="space-y-2">
            <label for="product-price" class="text-sm font-medium leading-none">Price</label>
            <input id="product-price" type="number" min="0" step="0.01" required class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
          </div>
        </div>
        <div class="space-y-2">
          <label for="product-description" class="text-sm font-medium leading-none">Description</label>
          <textarea id="product-description" required rows="3" class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"></textarea>
        </div>
        <div class="grid gap-4 md:grid-cols-2">
          <div class="space-y-2">
            <label for="product-stock" class="text-sm font-medium leading-none">Stock</label>
            <input id="product-stock" type="number" min="0" required class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
          </div>
          <div class="space-y-2">
            <label for="product-status" class="text-sm font-medium leading-none">Status</label>
            <select id="product-status" required class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
              <option value="In Stock">In Stock</option>
              <option value="Low Stock">Low Stock</option>
              <option value="Out of Stock">Out of Stock</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end gap-4">
          <button type="button" onclick="closeProductModal()" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
            Cancel
          </button>
          <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
            Save Product
          </button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/utils.js"></script>
  <script>
    let products = [
      {
        id: '1',
        name: 'Organic Rice',
        category: 'Grains',
        price: 250,
        stock: 50,
        status: 'In Stock',
        description: 'Premium organic rice from local farmers'
      },
      {
        id: '2',
        name: 'Fresh Mangoes',
        category: 'Fruits',
        price: 120,
        stock: 30,
        status: 'In Stock',
        description: 'Sweet and juicy mangoes'
      },
      {
        id: '3',
        name: 'Tomatoes',
        category: 'Vegetables',
        price: 80,
        stock: 45,
        status: 'In Stock',
        description: 'Fresh, ripe tomatoes'
      }
    ];

    function renderProductsTable() {
      const productsTableBody = document.getElementById('products-table-body');
      const filteredProducts = filterProducts(products);
      productsTableBody.innerHTML = filteredProducts.map(product => `
        <tr class="border-b">
          <td class="p-4">
            <div class="flex items-center gap-3">
              <div class="font-medium">${product.name}</div>
            </div>
          </td>
          <td class="p-4">${product.category}</td>
          <td class="p-4">â‚±${product.price.toLocaleString()}</td>
          <td class="p-4">${product.stock}</td>
          <td class="p-4">
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${
              product.status === 'In Stock' ? 'bg-green-100 text-green-700' :
              product.status === 'Low Stock' ? 'bg-yellow-100 text-yellow-700' :
              'bg-red-100 text-red-700'
            }">
              ${product.status}
            </span>
          </td>
          <td class="p-4">
            <div class="flex items-center gap-2">
              <button onclick="editProduct('${product.id}')" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8 p-0">
                <i class="ri-pencil-line h-4 w-4"></i>
              </button>
              <button onclick="deleteProduct('${product.id}')" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8 p-0">
                <i class="ri-delete-bin-line h-4 w-4"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Add these new functions for search and filter
    let currentFilters = {
      category: 'all',
      stock: 'all',
      searchQuery: ''
    };

    function filterProducts(products) {
      return products.filter(product => {
        // Apply search query filter
        const searchMatch = !currentFilters.searchQuery || 
          product.name.toLowerCase().includes(currentFilters.searchQuery.toLowerCase()) ||
          product.category.toLowerCase().includes(currentFilters.searchQuery.toLowerCase());

        // Apply category filter
        const categoryMatch = currentFilters.category === 'all' || product.category === currentFilters.category;

        // Apply stock filter
        const stockMatch = currentFilters.stock === 'all' || 
          (currentFilters.stock === 'in-stock' && product.stock > 0) ||
          (currentFilters.stock === 'out-of-stock' && product.stock === 0);

        return searchMatch && categoryMatch && stockMatch;
      });
    }

    function openFiltersModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-50';
      modal.innerHTML = `
        <div class="fixed inset-0 bg-background/80 backdrop-blur-sm"></div>
        <div class="fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 sm:rounded-lg">
          <div class="flex flex-col space-y-1.5">
            <h2 class="text-lg font-semibold leading-none tracking-tight">Filter Products</h2>
            <p class="text-sm text-muted-foreground">Select filters to apply to the products list.</p>
          </div>
          <div class="space-y-4">
            <div class="space-y-2">
              <label class="text-sm font-medium leading-none">Category</label>
              <select id="category-filter" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
                <option value="all">All Categories</option>
                <option value="Vegetables">Vegetables</option>
                <option value="Fruits">Fruits</option>
                <option value="Grains">Grains</option>
                <option value="Others">Others</option>
              </select>
            </div>
            <div class="space-y-2">
              <label class="text-sm font-medium leading-none">Stock Status</label>
              <select id="stock-filter" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50">
                <option value="all">All Stock Status</option>
                <option value="in-stock">In Stock</option>
                <option value="out-of-stock">Out of Stock</option>
              </select>
            </div>
            <div class="flex justify-end gap-4">
              <button onclick="closeFiltersModal()" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                Cancel
              </button>
              <button onclick="applyFilters()" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Apply Filters
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // Set current filter values
      document.getElementById('category-filter').value = currentFilters.category;
      document.getElementById('stock-filter').value = currentFilters.stock;
    }

    function closeFiltersModal() {
      const modal = document.querySelector('.fixed.inset-0.z-50:not(#product-modal)');
      if (modal) {
        modal.remove();
      }
    }

    function applyFilters() {
      const categoryFilter = document.getElementById('category-filter').value;
      const stockFilter = document.getElementById('stock-filter').value;
      currentFilters.category = categoryFilter;
      currentFilters.stock = stockFilter;
      renderProductsTable();
      closeFiltersModal();
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Check authentication
      if (!auth.requireSellerAuth()) {
        return;
      }

      // Load header
      fetch('components/header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header-container').innerHTML = data;
        });

      // Initial render of products table
      renderProductsTable();

      // Handle logout
      document.getElementById('logout-button').addEventListener('click', function() {
        auth.logout();
      });

      // Handle add product button
      document.getElementById('add-product-button').addEventListener('click', function() {
        openProductModal();
      });

      // Handle product form submission
      document.getElementById('product-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const name = document.getElementById('product-name').value;
        const category = document.getElementById('product-category').value;
        const price = parseFloat(document.getElementById('product-price').value);
        const description = document.getElementById('product-description').value;
        const stock = parseInt(document.getElementById('product-stock').value);
        const status = document.getElementById('product-status').value;

        const productId = this.dataset.productId;

        // Create the product data object
        const productData = {
          name,
          category,
          price,
          description,
          stock,
          status
        };

        if (productId) {
          // Update existing product
          const productIndex = products.findIndex(p => p.id === productId);
          if (productIndex !== -1) {
            products[productIndex] = {
              ...products[productIndex],
              ...productData
            };
            showNotification('Product updated successfully');
          }
        } else {
          // Create new product
          const newProduct = {
            id: 'PRD-' + (products.length + 1),
            ...productData
          };
          products.push(newProduct);
          showNotification('Product added successfully');
        }

        // Re-render products table
        renderProductsTable();

        // Close modal
        closeProductModal();
      });

      // Add search input handler
      const searchInput = document.querySelector('input[type="search"]');
      searchInput.addEventListener('input', function(e) {
        currentFilters.searchQuery = e.target.value;
        renderProductsTable();
      });

      // Add filter button handler
      const filterButton = document.querySelector('button:has(.ri-filter-line)');
      filterButton.addEventListener('click', openFiltersModal);
    });

    function openProductModal(productId = null) {
      const modal = document.getElementById('product-modal');
      const modalTitle = document.getElementById('modal-title');
      const form = document.getElementById('product-form');
      
      // Store the product ID on the form for reference during submission
      form.dataset.productId = productId || '';
      
      if (productId) {
        modalTitle.textContent = 'Edit Product';
        const product = products.find(p => p.id === productId);
        if (product) {
          document.getElementById('product-name').value = product.name;
          document.getElementById('product-category').value = product.category;
          document.getElementById('product-price').value = product.price;
          document.getElementById('product-description').value = product.description;
          document.getElementById('product-stock').value = product.stock;
          document.getElementById('product-status').value = product.status;
        }
      } else {
        modalTitle.textContent = 'Add Product';
        form.reset();
      }
      
      modal.classList.remove('hidden');
    }

    function closeProductModal() {
      document.getElementById('product-modal').classList.add('hidden');
      document.getElementById('product-form').reset();
    }

    function editProduct(productId) {
      openProductModal(productId);
    }

    function deleteProduct(productId) {
      if (confirm('Are you sure you want to delete this product?')) {
        // Remove product from array
        products = products.filter(p => p.id !== productId);
        // Re-render products table
        renderProductsTable();
        showNotification('Product deleted successfully');
      }
    }
  </script>
</body>
</html> 